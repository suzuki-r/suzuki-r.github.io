<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="EN-US">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="mypane.css">
    <title>Jupyter/ipynb</title>
    <style>
      .quote {width: 80%;border-style: solid; border-color: rgb(98, 150, 102); border-width: 1px 3px 3px 1px;
        margin: 0px 0px 0px 40px; text-indent: 1em;	line-height: 0.8;	background-color: rgb(230, 248, 228);}
        .cont{width: 50%; text-align: center;	padding: 1em;	border: solid thin;	margin: 0 auto 0 auto;
        text-indent: 2em; line-height: 1.4; font size: 4; word-wrap:auto;}
div.comments{margin: 0px auto; text-align: left; width: 90%; background-color:white}
  </style>
  </head>
  <body>
    <div class="wrapper">
      <div class="sidenav">
        <div class="sidemenu"><a href="panel.html" target="_top">Links</a></div>
        <div class="sidemenu"><a href="old.html" target="_top">Old</a></div>
        <div class="sidemenu"><a href="online.html" target="_top">Web resources</a></div>
        <div class="sidemenu"><a href="MathematicaTips.html" target="_top">Mathematica</a></div>
        <div class="sidemenu"><a href="MathKernelTips.html" target="_top">Math Kernel</a></div>
        <div class="sidemenu"><a href="GAP.html" target="_top">GAP</a></div>
        <div class="sidemenu"><a href="Python.html" target="_top">Python</a></div>
        <div class="sidemenu_on"><a href="Jupyter.html" target="_top">Jupyter</a></div>
        <div class="sidemenu"><a href="Qiskit.html" target="_top">Qiskit</a></div>
        <div class="sidemenu"><a href="SageMath.html" target="_top">SageMath</a></div>
      </div>
      <div class="contents_sub">
        <h2 style="text-align: center;">How to Use Jupyter / ipynb</h2>
        <hr style="width: 95%;"><br>
        <div align="center">
          <div style="margin: 0px auto; text-align: left; width: 30%;">
              <a href="#sec1">1. Preliminary</a><br>
            <a href="#sec2">2. Launch</a><br>
            <a href="#sec3">3. Code and Run</a><br>
            <a href="#sec4">4. Install pyenv-virtualenv</a><br>
            <a href="#sec5">5. Troubleshooting</a><br>
            <a href="#sec6">6. Uninstall</a><br>
            </div>
        </div>
        <br>
        <hr style="width: 95%;">
        <h3 id="sec1">1. Preliminary<br>
        </h3>
        <div style="margin-left:30px; margin-right:30px;">
          <p>
            Python has an interacting interpreter called REPL, and ipython is a generalization of REPL.
            When

            Jupyter is a working environment on Web browsers.
            Jupyter can have multiple kernels for each language to execute the code.
            If the coding language is Python, then Jupyter uses ipython kernel.

          </p>
          <p>Jupyter is a notebook interface of Pyhton and works like
            Mathematica notebooks. One can immediately execute the program
            without compiling the code. Jupyter is one of the Python libraries.
            There are useful libraries such as sympy (Symbolic computation),
            TensorFlow (Machine learning). </p>
          <p>Jupyter can be installed in several ways;</p>
          <ol>
            <li> (minimal) by pip, the official package installer of Pyhton;
              should install additional modules later.</li>
            <li> (simple) downloading OS X graphical version of <a href="https://www.anaconda.com/products/individual">Anaconda</a>;
              should launch it from Application and not Terminal</li>
              <li> (advanced) by Environment Isolation Tool (EIT); see also <a href="python.html">this page</a></li>
          </ol>
          <p>These installations are completely independent. When you use
            Jupyter under EIT, you need to activate the particular virtual
            environment every time, rather than immediately typing <i>jupyter
              notebook</i> in Terminal.</p>
          <p>If you do not want to skip installation troubles, the simplest way to use Python is to use <a href="https://colab.research.google.com/notebooks/welcome.ipynb">Google Colab</a>. However, you may lose the calculation results on Colab when you are disconnected from Internet.
          </p>
        </div>
        <h3 id="sec2">2. Launch<br>
        </h3>
          <h4>2-1. Quick methods</h4>
          <div style="margin-left:30px; margin-right:30px;">
            <p>Text editors such as <i>Visual Studio Code</i> can open .ipynb files. Another simple way is to use Google Colab.
            </p>
          </div>
          <h4>2-2. Pyenv-virtualenv</h4>
          <div style="margin-left:30px; margin-right:30px;">
            <p>Here we explain how to open a jupyter notebook, assuming we finished installation in <a href="#sec4">Section 4</a>.</p>
              <p>First go to the folder where your code is found. Check the installed virtual environments by</p>
            <div class="quote">
              <pre>$ pyenv virtualenvs</pre>
            </div>
            <p>Activate the preferred virtual environment</p>
            <div class="quote">
              <pre>pyenv activate <i>environment_name</i></pre>
              <pre>jupyter notebook</pre>
            </div>
          </div>
          <h4>2-3. TensorFlow</h4>
          <div style="margin-left:30px; margin-right:30px;">
            <p>To use TensorFlow, follow the <a href="https://www.tensorflow.org/install">official instruction</a>.
              There is also an instruction for Apple Silicon devices <a href="https://towardsdatascience.com/installing-tensorflow-and-jupyter-notebook-on-apple-silicon-macs-d30b14c74a08">here</a>.
              We use <b>virtualenv</b> to install TensorFlow. In other words, you install Jupyter <b>below</b> the TensorFlow folder, even if you have Jupyter elsewhere; see <a href="https://stackoverflow.com/questions/37061089/trouble-with-tensorflow-in-jupyter-notebook">this
            post</a>.
            Of course, one can work with other machine learning frameworks, other virtual
              environments of Python, and other bash profiles.
            </p>
          <p>i) Launch TensorFlow from Terminal <sup><a href="#fn1" id="ref1">1</a></sup></p>
          <div class="quote">
            <pre>source ~/tensorflow/bin/activate</pre>
          </div>
          <p>ii) Open Jupyter notebook <sup><a href="#fn2" id="ref2">2</a></sup></p>
          <div class="quote">
            <pre>jupyter notebook</pre>
          </div>
          <p>or</p>
          <div class="quote">
            <pre>jupyter notebook <i>filename</i>.ipynb</pre>
          </div>
          <p> iii) Copy &amp; paste the URL shown in Terminal to the web
            browser:</p>
            <div class="quote">
              <pre>http://localhost:8888/?token=(something)</pre>
            </div>
            <p>To skip this step, try the tricks of <a href="https://stackoverflow.com/questions/44176160/jupyter-notebooks-startup-and-stopping">this</a> and <a href="https://jupyter-notebook.readthedocs.io/en/latest/public_server.html">that</a>.
          </p>
          <p> iv) We should terminate the virtual environment</p>
          <div class="quote">
            <pre>source deactivate</pre>
          </div>
          <p>If you use Anaconda, this should be</p>
          <div class="quote">
            <pre>conda deactivate</pre>
          </div>
          <p></p>
        </div>
          <h3 id="sec3">3. Code and Run<br>
        </h3>
        <div style="margin-left:30px; margin-right:30px;">
          <p>Commands are executed by Shift+Return. "In []" becomes "[*]" during
            evaluating, and turns into "[number]" when it finishes. </p>
        </div>
          <h3 id="sec4">4. Install pyenv-virtualenv<br>
        </h3>
        <div style="margin-left:30px; margin-right:30px;">
          <p>People emphasize the importance of virtual environments, to
            check the consistency of python versions, package requirements and
            package installation trees. Several tools are available, such as <b>pyenv-virtualenv</b>, <b>pyenv-virtualenv</b>, <b>Anaconda</b> and <b>Pipenv</b>.
            Below I explain <b>pyenv-virtualenv</b>. </p>
          <p>First, we install or upgrade pyenv by Homebrew,</p>
          <div class="quote">
              <pre>brew install pyenv</pre>
              <pre>brew install pyenv-virtualenv</pre>
            </div>
            <p>To install Homebrew on Linux, see <a href="https://stackoverflow.com/questions/33353618/can-i-use-homebrew-on-ubuntu">SE</a>. The mirror in <a href="https://mirror.tuna.tsinghua.edu.cn/help/homebrew/">Tsinghua</a> is useful if you are inside China. The system may automatically launch </p>
            <div class="quote">
              <pre>brew cleanup</pre>
            </div>
            <p>In case you find a permission error, try (see <a href="https://github.com/Homebrew/homebrew-core/issues/45009">this
            post</a>)</p>
          <div class="quote">
            <pre>sudo chown -R $(whoami) $(brew --prefix)/*</pre>
          </div>
          <p>Second, we install the latest version of Python. You can check it
            by the official website, or by typing </p>
          <div class="quote">
            <pre>pyenv install --list</pre>
          </div>
          <p>If the latest version is 3.x.y, you install it, change the python
              version of the current user, and refresh the status.<sup><a href="#fn3" id="ref3">3</a></sup></p>
          <div class="quote">
            <pre>pyenv install 3.x.y</pre>
            <pre>pyenv global 3.x.y</pre>
            <pre>eval "$(pyenv init -)"</pre>
          </div>
          <p>We can check installed versions,</p>
          <div class="quote">
            <pre>pyenv versions</pre>
            <pre>python --version</pre>
            <pre>pip -V</pre>
          </div>
            <p>Do not forget to switch the python version in pyenv to the latest one, because the system (default) python does not contain pip.<sup><a href="#fn4" id="ref4">4</a></sup></p>
            <div class="quote">
              <pre>pyenv global 3.x.y</pre>
            </div>
            <p>Third, we install (the latest version of) <b>Jupyter</b>. However,
            Jupyter is not in the pyenv's install list. A typical error is</p>
            <div class="quote">
              <pre>pyenv: jupyter: command not found</pre>
            </div>
            <p>We solve this problem under a virtual environment. For this purpose, let us create a virtual environment under the name <i>environment_name</i>. </p>
            <div class="quote">
              <pre>pyenv virtualenv <i>python_version</i> <i>environment_name</i></pre>
            </div>
            <p>If we omit <i>python_version</i>, then the system uses the default environment specified by ~/.pyenv/version. We can check newly created environments by "$ pyenv versions". </p>
            <div class="quote">
              <pre>pyenv activate <i>environment_name</i></pre>
              <pre>python3 -m pip install jupyter</pre>
            </div>
            <p>We installed the Jupyter module under your environment.
              The last command is needed to avoid the error <i>Defaulting to user installation because normal site-packages is not writeable</i>;
              see <a href="https://itsmycode.com/solved-defaulting-to-user-installation-because-normal-site-packages-is-not-writeable/">this website</a>.
              If the Jupyter module is not installed on the working environment, Python may launch the Jupyter installed on your system, which can cause extra troubles.
              Other modules can be installed in a similar way.</p>
              <p>You should turn on a virtual environment whenever you launch a jupyter notebook,</p>
              <div class="quote">
                <pre>pyenv activate <i>environment_name</i></pre>
                <pre>jupyter notebook</pre>
              </div>
            <p>You can deactivate an environment by</p>
            <div class="quote">
              <pre>pyenv deactivate</pre>
            </div>
            <p>You can delete an environment by</p>
            <div class="quote">
              <pre>pyenv virtualenv-delete <i>environment_name</i></pre>
            </div>
            <h3 id="sec5">5. Troubleshooting<br>
            </h3>
            <p>
              Check if your problem is related to the virtual environment or not.
              The difference between two notebooks can be checked by installing <a href="https://github.com/jupyter/nbdime">nbdime</a>.
            </p>
            <h4>5-1. Error: module not found</h4>
            <p>
              One of the most common reason is that you did not <b>switch iPython kernel</b>.
              Check "Kernels > Switch Kernel" in the menu of Jupyter notebook.
            </p>
            <div style="margin-left: 20px;">
              <img src="switch_kernel.png" alt="PNG" width="200" height="60">
            </div>
            <p>
              If it does not solve the problem, the reason can be more complicated. For example
            </p>
            <ul>
              <li>
                Pyenv tries to use the same jupyter kernel for any virtual environments; see <a href="https://github.com/pyenv/pyenv/issues/1675">discussion here</a>.
                You can localize Jupyter for each environment to avoid this problem.
                Try installing <a href="https://github.com/aiguofer/pyenv-jupyter-kernel">this plugin</a>.
              </li>
              <li>
                Sometimes pip and Jupyter notebook use different paths or kernels.
                This means that, after you install some modules by pip inside a Jupyter notebook, the Jupyter kernel cannot detect the modules.
                See <a href="https://stackoverflow.com/questions/63774490/jupyter-not-recognising-numpy-using-homebrew-pyenv">this discussion</a>.
              </li>
              <li>
                Another possible workaound is to write a PATH to shims and not bin.
                A shim is an English word for something like a washer.
                See <a href="https://mungingdata.com/python/how-pyenv-works-shims/">this page</a> to find what shims do in pyenv.
              </li>
            </ul>
            <h4>5-2. Apple Silicon problems</h4>
            <p>
              Migration from Intel (x64) to Apple Silicon (ARM) causes a lot of problems for OSX users.
            </p><p>
              First, you need to reinstall Homebrew; see <a href="https://earthly.dev/blog/homebrew-on-m1/">this page</a>.
              Second, when two homebrew folders coexist (/usr/local/ for x64 and /opt/homebrew/ for ARM), some python packages find the old folder and cause errors.
              This can be avoided by deleting the wrong package from x64 homebrew; see <a href="https://github.com/pyenv/pyenv/issues/2573">discussion here</a>.
              For example, one can remove a package by
            </p>
            <div class="quote">
              <pre>/usr/local/bin/brew uninstall <i>package_name</i></pre>
            </div>
            <p>
              or completely remove the old brew by (cf. <a href="https://stackoverflow.com/questions/70989823/uninstall-homebrew-from-usr-local-without-affecting-opt-homebrew">this page</a>)
            </p>
            <div class="quote">
              <pre>sudo /bin/zsh </pre>
              <pre>arch -x86_64 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/uninstall.sh)"</pre>
            </div>
            <p>
              Third, before installing python you should delete cache to avoid downloading x64 packages.
            </p>
            <div class="quote">
              <pre>pip cache purge</pre>
              <pre>pyenv install 3.11.2</pre>
            </div>
            <p>
              for python and pyenv.
              Fourth, jupyter kernel may still die immediately after launch;
              see <a href="https://blog.roboflow.com/how-to-run-jupyter-notebooks-on-a-mac-m1/">this page</a> to fix it.
            </p>
            <p>
              In my environment, several python versions are found at $HOME/Library/Python/X.Y/.
              These files seem to be installed by "pip --user" for Intel CPU, but they cannot be removed by "pip uninstall" anymore.
              Instead of deleting the files (and reinstalling XCode Command Line Tools), I deleted PYTHONPATH from $HOME/.zshrc.
              Then "jupyter notebook" launches the newly installed kernel.
            </p>
            <p>
              Note that ZSH has several environment files. In particular, $HOME/.zprofile is loaded earlier than $HOME/.zshrc;
              see <a href="https://apple.stackexchange.com/questions/388622/zsh-zprofile-zshrc-zlogin-what-goes-where">here</a>.
            </p>
          <h3 id="sec6">6. Uninstall<br>
          </h3>
          <p>We can remove the old version of Anaconda, python or unwanted virtual environments by</p>
          <div class="quote">
            <pre>pyenv uninstall anaconda3-x.y.z</pre>
          </div>
          <p>If we remove pyenv and pyenv-virtualenv, execute the following steps. First delete folders,</p>
            <div class="quote">
            <pre>sudo rm -rf ~/.pyenv</pre>
            </div>
          <p>Uninstall pyenv and pyenv-virtualenv using homebrew,</p>
            <div class="quote">
            <pre>brew uninstall pyenv-virtualenv</pre>
            <pre>brew uninstall pyenv</pre>
            <pre>brew list</pre>
            </div>
          <p>The last command checks whether you uninstalled pyenv and pyenv-virtualenv successfully.</p>
        </div>
        <br>
        <hr>
          <sup id="fn1">1</sup> $ source <i>filename</i> (or $ . <i> filename</i>
          ) executes the contents of <i>filename</i> in the current shell.<sup><a
          href="#ref1">?</a></sup><br>
          <sup id="fn2">2</sup> $ ipython <i>notebook</i> was an old version of $
          jupyter <i> notebook</i>.<sup><a href="#ref2">?</a></sup><br>
          <sup id="fn3">3</sup> The following line in the ~/.bash_profile
        changes the prompt of OSX Terminal session,<br>
        &nbsp; $&nbsp; eval "$(pyenv virtualenv-init -)"<br>
        because <i>eval</i> changes the environment of the main bash shell.
        Since one cannot "deactivate" pyenv-virtualenv like virtualenv, one
        should either delete the line, or use<br>
        &nbsp; $&nbsp; export PYENV_VIRTUALENV_DISABLE_PROMPT=1 <br>
          <sup id="fn4">4</sup> There can be extra troubles in Ubuntu.<sup><a
          href="#ref4">?</a></sup><br>
        <p> </p>
      </div>
    </div>
  </body>
</html>
